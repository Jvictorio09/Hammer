<!-- Stats / Track Record (with count-up) -->
<section class="relative bg-[#1A1A1A] text-white py-20 overflow-hidden">
  <div class="absolute inset-0 opacity-10"
       style="background-image:url('https://www.transparenttextures.com/patterns/white-diamond.png')"></div>

  <div class="relative max-w-7xl mx-auto px-6 grid md:grid-cols-4 gap-10 text-center">
    <!-- Stat -->
    <div class="px-4 md:border-r md:border-white/10">
      <p class="stat-number"
         data-target="650"
         data-suffix="+">0</p>
      <p class="mt-3 text-xs tracking-[.2em] uppercase text-white/80">Projects Completed</p>
    </div>

    <!-- Stat -->
    <div class="px-4 md:border-r md:border-white/10">
      <p class="stat-number"
         data-target="20"
         data-suffix="+">0</p>
      <p class="mt-3 text-xs tracking-[.2em] uppercase text-white/80">Years of Expertise</p>
    </div>

    <!-- Stat -->
    <div class="px-4 md:border-r md:border-white/10">
      <p class="stat-number"
         data-target="1000"
         data-suffix="+">0</p>
      <p class="mt-3 text-xs tracking-[.2em] uppercase text-white/80">Skilled Professionals</p>
    </div>

    <!-- Stat (compact “M+”) -->
    <div class="px-4">
      <p class="stat-number"
         data-target="4000000"
         data-compact="true"
         data-suffix="+">0</p>
      <p class="mt-3 text-xs tracking-[.2em] uppercase text-white/80">Sq Ft Delivered</p>
    </div>
  </div>
</section>

<style>
/* Typography + subtle glow */
.stat-number{
  font-size: clamp(2.5rem, 5vw, 3.5rem);
  font-weight: 800;
  line-height: 1;
  letter-spacing: -0.02em;
  color: #18AFAB; /* Hammer teal */
  text-shadow: 0 0 14px rgba(24,175,171,0.35);
  opacity: 0;
  transform: translateY(12px) scale(.98);
  transition: opacity .6s ease, transform .6s ease;
}
.stat-number.is-visible{
  opacity: 1;
  transform: translateY(0) scale(1);
}
</style>

<script>
(function(){
  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  // Easing for a nicer count
  function easeOutQuad(t){ return t * (2 - t); }

  // Format compact (4,000,000 -> 4M, 1,500,000 -> 1.5M)
  function compactNumber(n){
    if (n >= 1_000_000_000) return (n/1_000_000_000).toFixed(n%1_000_000_000 ? 1 : 0) + 'B';
    if (n >= 1_000_000)     return (n/1_000_000).toFixed(n%1_000_000 ? 1 : 0) + 'M';
    if (n >= 1_000)         return (n/1_000).toFixed(n%1_000 ? 1 : 0) + 'K';
    return String(n);
  }

  function animateCount(el, target, {duration=1200, compact=false, suffix='' } = {}){
    if (prefersReduced){
      el.textContent = (compact ? compactNumber(target) : target.toLocaleString()) + (suffix||'');
      return;
    }

    const start = performance.now();
    const startVal = 0;

    function frame(now){
      const t = Math.min(1, (now - start) / duration);
      const eased = easeOutQuad(t);
      const current = Math.floor(startVal + (target - startVal) * eased);
      el.textContent = (compact ? compactNumber(current) : current.toLocaleString()) + (suffix||'');
      if (t < 1) requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
  }

  const stats = document.querySelectorAll('.stat-number');
  if(!('IntersectionObserver' in window)){
    // Fallback: animate immediately
    stats.forEach(el=>{
      const target = Number(el.getAttribute('data-target') || 0);
      const suffix = el.getAttribute('data-suffix') || '';
      const compact = el.getAttribute('data-compact') === 'true';
      el.classList.add('is-visible');
      animateCount(el, target, {compact, suffix});
    });
    return;
  }

  const io = new IntersectionObserver((entries, obs)=>{
    entries.forEach(entry=>{
      if(!entry.isIntersecting) return;
      const el = entry.target;
      const target = Number(el.getAttribute('data-target') || 0);
      const suffix = el.getAttribute('data-suffix') || '';
      const compact = el.getAttribute('data-compact') === 'true';

      el.classList.add('is-visible');
      animateCount(el, target, {compact, suffix});

      obs.unobserve(el); // run once
    });
  }, { threshold: 0.3 });

  stats.forEach(el => io.observe(el));
})();
</script>
