{# templates/insights/detail.html #}
{% extends "base.html" %}
{% load editorjs %}
{% block title %}{{ insight.title }} | Insights | Hammer Group{% endblock %}
{% block content %}
<section class="py-12 md:py-16 bg-white">
  <div class="max-w-7xl mx-auto px-6 grid grid-cols-1 lg:grid-cols-12 gap-10">
    <!-- Main content -->
    <div class="lg:col-span-8">
      <p class="text-[11px] tracking-[.45em] uppercase text-[#18AFAB]">{{ insight.tag|default:"Insight" }}</p>
      <h1 class="text-3xl md:text-4xl font-extrabold mt-2">{{ insight.title }}</h1>
      <p class="text-gray-500 mt-2">{{ insight.read_minutes }} min read • {{ insight.published_at|date:"M j, Y" }}</p>
      {% if insight.cover_image_url %}
        <img src="{{ insight.cover_image_url }}" alt="{{ insight.title }}" class="w-full rounded-2xl shadow mt-6">
      {% endif %}
      {% if insight.excerpt %}
        <p class="text-lg text-gray-700 mt-6">{{ insight.excerpt }}</p>
      {% endif %}
      {% if insight.blocks %}
        <article class="prose lg:prose-lg mt-6 max-w-none">{{ insight.blocks|render_editorjs }}</article>
      {% elif insight.body %}
        <article class="prose lg:prose-lg mt-6 max-w-none">{{ insight.body|safe }}</article>
      {% endif %}
    </div>

    <!-- Sticky sidebar: related posts -->
    <aside class="lg:col-span-4 lg:pl-4">
      <div class="lg:sticky lg:top-24">
        <h3 class="text-sm font-semibold tracking-[.25em] uppercase text-[#0F0F10]/70">Related</h3>
        <ul class="mt-4 space-y-5">
          {% if related %}
            {% for r in related %}
              <li class="group">
                <a href="{% url 'insight_detail' r.slug %}" class="flex items-start gap-3">
                  <div class="w-20 h-20 rounded-lg overflow-hidden bg-gray-100 shadow-sm flex-shrink-0">
                    <img src="{{ r.cover_image_url|default:'https://picsum.photos/200/120?blur=2' }}" alt="{{ r.title }}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                  </div>
                  <div class="flex-1 min-w-0">
                    <p class="text-xs text-[#18AFAB] tracking-[.25em] uppercase">{{ r.tag|default:'Insight' }}</p>
                    <h4 class="text-sm font-semibold leading-snug line-clamp-2 group-hover:underline">{{ r.title }}</h4>
                    <p class="text-xs text-gray-500 mt-1">{{ r.read_minutes }} min • {{ r.published_at|date:'M j, Y' }}</p>
                  </div>
                </a>
              </li>
            {% endfor %}
          {% else %}
            <li class="text-sm text-gray-500">More articles coming soon.</li>
          {% endif %}
        </ul>

        <!-- CTA card -->
        <div class="mt-8 p-5 rounded-xl border border-black/5 bg-gray-50">
          <p class="text-sm font-semibold">Want help with {{ insight.service.title|default:'your project' }}?</p>
          <p class="text-sm text-gray-600 mt-1">Speak to our team for a quick consultation.</p>
          <a href="{% url 'contact' %}" class="inline-flex items-center gap-2 mt-3 text-[#18AFAB] font-semibold">
            Contact us <i class="fa-solid fa-arrow-right-long"></i>
          </a>
        </div>
      </div>
    </aside>
  </div>
</section>

<style>
.line-clamp-2{ display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
</style>
{% endblock %}
